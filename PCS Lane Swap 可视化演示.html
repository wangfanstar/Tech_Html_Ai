<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>PCS Lane Swap å¯è§†åŒ–æ¼”ç¤º</title>  
    <style>  
        * {  
            margin: 0;  
            padding: 0;  
            box-sizing: border-box;  
        }  

        body {  
            font-family: 'Microsoft YaHei', Arial, sans-serif;  
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);  
            padding: 20px;  
            min-height: 100vh;  
        }  

        .container {  
            max-width: 1600px;  
            margin: 0 auto;  
            background: white;  
            border-radius: 20px;  
            padding: 40px;  
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);  
        }  

        h1 {  
            text-align: center;  
            color: #2c3e50;  
            margin-bottom: 15px;  
            font-size: 32px;  
        }  

        .subtitle {  
            text-align: center;  
            color: #7f8c8d;  
            margin-bottom: 40px;  
            font-size: 16px;  
        }  

        .stage-container {  
            display: flex;  
            gap: 30px;  
            margin: 30px 0;  
            align-items: center;  
        }  

        .endpoint {  
            flex: 0 0 200px;  
            background: #f8f9fa;  
            border-radius: 15px;  
            padding: 25px;  
            border: 3px solid #3498db;  
        }  

        .endpoint-title {  
            font-size: 18px;  
            font-weight: bold;  
            color: #2c3e50;  
            margin-bottom: 20px;  
            text-align: center;  
            padding: 10px;  
            background: linear-gradient(135deg, #3498db, #2980b9);  
            color: white;  
            border-radius: 8px;  
        }  

        .lane-port {  
            display: flex;  
            align-items: center;  
            margin: 12px 0;  
            gap: 10px;  
            transition: all 0.3s;  
        }  

        .lane-port:hover {  
            transform: translateX(5px);  
        }  

        .lane-label {  
            width: 80px;  
            padding: 10px;  
            background: linear-gradient(135deg, #27ae60, #2ecc71);  
            color: white;  
            border-radius: 8px;  
            text-align: center;  
            font-weight: bold;  
            font-size: 14px;  
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);  
        }  

        .lane-label.inverted {  
            background: linear-gradient(135deg, #e74c3c, #c0392b);  
        }  

        .connector-dot {  
            width: 16px;  
            height: 16px;  
            background: #3498db;  
            border-radius: 50%;  
            border: 3px solid white;  
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.5);  
        }  

        .connection-area {  
            flex: 1;  
            position: relative;  
            min-height: 400px;  
            background: #f8f9fa;  
            border-radius: 15px;  
            padding: 20px;  
            border: 2px dashed #bdc3c7;  
        }  

        .connection-line {  
            position: absolute;  
            height: 3px;  
            background: linear-gradient(90deg, #3498db, #9b59b6);  
            transform-origin: left center;  
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);  
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);  
        }  

        .connection-line.crossed {  
            background: linear-gradient(90deg, #e74c3c, #f39c12);  
            animation: flowAnimation 2s infinite;  
        }  

        @keyframes flowAnimation {  
            0%, 100% { opacity: 1; }  
            50% { opacity: 0.6; }  
        }  

        .connection-line::after {  
            content: '';  
            position: absolute;  
            right: -8px;  
            top: 50%;  
            transform: translateY(-50%);  
            width: 0;  
            height: 0;  
            border-left: 12px solid currentColor;  
            border-top: 8px solid transparent;  
            border-bottom: 8px solid transparent;  
        }  

        .swap-indicator {  
            position: absolute;  
            background: #f39c12;  
            color: white;  
            padding: 8px 15px;  
            border-radius: 20px;  
            font-size: 12px;  
            font-weight: bold;  
            box-shadow: 0 3px 10px rgba(243, 156, 18, 0.4);  
            white-space: nowrap;  
        }  

        .controls {  
            display: flex;  
            gap: 15px;  
            justify-content: center;  
            margin: 30px 0;  
            flex-wrap: wrap;  
        }  

        .btn {  
            padding: 12px 30px;  
            border: none;  
            border-radius: 8px;  
            font-size: 16px;  
            font-weight: bold;  
            cursor: pointer;  
            transition: all 0.3s;  
            color: white;  
        }  

        .btn-primary {  
            background: linear-gradient(135deg, #3498db, #2980b9);  
        }  

        .btn-primary:hover {  
            transform: translateY(-2px);  
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);  
        }  

        .btn-success {  
            background: linear-gradient(135deg, #27ae60, #229954);  
        }  

        .btn-warning {  
            background: linear-gradient(135deg, #f39c12, #e67e22);  
        }  

        .btn-danger {  
            background: linear-gradient(135deg, #e74c3c, #c0392b);  
        }  

        .config-panel {  
            background: #fff3cd;  
            border: 3px solid #ffc107;  
            border-radius: 15px;  
            padding: 25px;  
            margin: 30px 0;  
        }  

        .config-title {  
            font-size: 18px;  
            font-weight: bold;  
            color: #856404;  
            margin-bottom: 20px;  
            text-align: center;  
        }  

        .config-grid {  
            display: grid;  
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));  
            gap: 15px;  
        }  

        .config-item {  
            background: white;  
            padding: 15px;  
            border-radius: 10px;  
            border: 2px solid #ffc107;  
        }  

        .config-item-header {  
            font-weight: bold;  
            color: #2c3e50;  
            margin-bottom: 10px;  
            display: flex;  
            align-items: center;  
            gap: 10px;  
        }  

        .config-item-value {  
            font-family: 'Courier New', monospace;  
            color: #7f8c8d;  
            font-size: 14px;  
            line-height: 1.8;  
        }  

        .status-indicator {  
            width: 12px;  
            height: 12px;  
            border-radius: 50%;  
            display: inline-block;  
        }  

        .status-ok {  
            background: #27ae60;  
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);  
        }  

        .status-warning {  
            background: #f39c12;  
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);  
        }  

        .status-error {  
            background: #e74c3c;  
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);  
        }  

        .info-box {  
            background: #e8f4f8;  
            border-left: 5px solid #3498db;  
            padding: 20px;  
            border-radius: 8px;  
            margin: 30px 0;  
        }  

        .info-box h3 {  
            color: #2980b9;  
            margin-bottom: 15px;  
        }  

        .info-box ul {  
            list-style: none;  
            line-height: 2;  
            color: #34495e;  
        }  

        .info-box li::before {  
            content: "âœ“ ";  
            color: #27ae60;  
            font-weight: bold;  
            margin-right: 8px;  
        }  

        .scenario-selector {  
            display: flex;  
            gap: 15px;  
            justify-content: center;  
            margin: 30px 0;  
            flex-wrap: wrap;  
        }  

        .scenario-btn {  
            padding: 15px 25px;  
            background: white;  
            border: 3px solid #3498db;  
            border-radius: 12px;  
            cursor: pointer;  
            transition: all 0.3s;  
            font-weight: bold;  
            color: #2c3e50;  
        }  

        .scenario-btn:hover {  
            background: #3498db;  
            color: white;  
            transform: translateY(-3px);  
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.3);  
        }  

        .scenario-btn.active {  
            background: linear-gradient(135deg, #27ae60, #2ecc71);  
            border-color: #27ae60;  
            color: white;  
        }  

        .legend {  
            display: flex;  
            gap: 25px;  
            justify-content: center;  
            margin-top: 30px;  
            padding: 20px;  
            background: #f8f9fa;  
            border-radius: 12px;  
            flex-wrap: wrap;  
        }  

        .legend-item {  
            display: flex;  
            align-items: center;  
            gap: 10px;  
            font-size: 14px;  
        }  

        .legend-line {  
            width: 40px;  
            height: 4px;  
            border-radius: 2px;  
        }  
    </style>  
</head>  
<body>  
    <div class="container">  
        <h1>ğŸ”„ PCS Lane Swap å¯è§†åŒ–æ¼”ç¤º</h1>  
        <p class="subtitle">äº¤äº’å¼å±•ç¤ºLaneæ˜ å°„ã€ææ€§ç¿»è½¬å’Œè‡ªåŠ¨ä¿®æ­£è¿‡ç¨‹</p>  

        <!-- åœºæ™¯é€‰æ‹© -->  
        <div class="scenario-selector">  
            <div class="scenario-btn active" onclick="loadScenario('normal')">  
                æ­£å¸¸è¿æ¥  
            </div>  
            <div class="scenario-btn" onclick="loadScenario('simple_swap')">  
                ç®€å•äº¤æ¢  
            </div>  
            <div class="scenario-btn" onclick="loadScenario('complex_swap')">  
                å¤æ‚äº¤å‰  
            </div>  
            <div class="scenario-btn" onclick="loadScenario('with_polarity')">  
                å«ææ€§ç¿»è½¬  
            </div>  
            <div class="scenario-btn" onclick="loadScenario('random')">  
                éšæœºåœºæ™¯  
            </div>  
        </div>  

        <!-- æ§åˆ¶æŒ‰é’® -->  
        <div class="controls">  
            <button class="btn btn-primary" onclick="showPhysicalConnection()">  
                â‘  æ˜¾ç¤ºç‰©ç†è¿æ¥  
            </button>  
            <button class="btn btn-warning" onclick="detectLaneMapping()">  
                â‘¡ è‡ªåŠ¨æ£€æµ‹æ˜ å°„  
            </button>  
            <button class="btn btn-success" onclick="applyLaneSwap()">  
                â‘¢ åº”ç”¨Lane Swap  
            </button>  
            <button class="btn btn-danger" onclick="resetDemo()">  
                ğŸ”„ é‡ç½®  
            </button>  
        </div>  

        <!-- ä¸»æ˜¾ç¤ºåŒºåŸŸ -->  
        <div class="stage-container">  
            <!-- TXç«¯ -->  
            <div class="endpoint">  
                <div class="endpoint-title">TX å‘é€ç«¯</div>  
                <div id="tx-lanes"></div>  
            </div>  

            <!-- è¿æ¥åŒºåŸŸ -->  
            <div class="connection-area" id="connection-area">  
                <div style="text-align: center; color: #7f8c8d; padding: 20px;">  
                    ç‰©ç†è¿æ¥å±‚ (å…‰çº¤/PCBèµ°çº¿)  
                </div>  
            </div>  

            <!-- RXç«¯ -->  
            <div class="endpoint">  
                <div class="endpoint-title">RX æ¥æ”¶ç«¯</div>  
                <div id="rx-lanes"></div>  
            </div>  
        </div>  

        <!-- é…ç½®é¢æ¿ -->  
        <div class="config-panel" id="config-panel" style="display: none;">  
            <div class="config-title">ğŸ”§ Lane Swap é…ç½®ä¿¡æ¯</div>  
            <div class="config-grid" id="config-grid"></div>  
        </div>  

        <!-- ä¿¡æ¯è¯´æ˜ -->  
        <div class="info-box">  
            <h3>ğŸ“– Lane Swap åº”ç”¨åœºæ™¯</h3>  
            <ul>  
                <li><strong>PCBå¸ƒçº¿ä¼˜åŒ–</strong>: ä¸ºäº†ç¼©çŸ­èµ°çº¿ã€å‡å°‘å±‚æ•°ï¼Œå…è®¸Laneäº¤å‰</li>  
                <li><strong>å…‰æ¨¡å—é€‚é…</strong>: ä¸åŒå‚å•†å…‰æ¨¡å—å†…éƒ¨Laneæ˜ å°„å¯èƒ½ä¸åŒ</li>  
                <li><strong>ææ€§çº æ­£</strong>: è‡ªåŠ¨å¤„ç†P/Nä¿¡å·çº¿åæ¥é—®é¢˜</li>  
                <li><strong>çƒ­æ’æ‹”æ”¯æŒ</strong>: è¿è¡Œæ—¶è‡ªåŠ¨æ£€æµ‹å’Œé…ç½®Laneé¡ºåº</li>  
                <li><strong>æˆæœ¬é™ä½</strong>: æ— éœ€ä¸¥æ ¼æ§åˆ¶PCBèµ°çº¿é¡ºåºï¼Œé™ä½åˆ¶é€ éš¾åº¦</li>  
            </ul>  
        </div>  

        <!-- å›¾ä¾‹ -->  
        <div class="legend">  
            <div class="legend-item">  
                <div class="legend-line" style="background: linear-gradient(90deg, #3498db, #9b59b6);"></div>  
                <span>æ­£å¸¸è¿æ¥</span>  
            </div>  
            <div class="legend-item">  
                <div class="legend-line" style="background: linear-gradient(90deg, #e74c3c, #f39c12);"></div>  
                <span>äº¤å‰è¿æ¥</span>  
            </div>  
            <div class="legend-item">  
                <div class="status-indicator status-ok"></div>  
                <span>Laneæ­£å¸¸</span>  
            </div>  
            <div class="legend-item">  
                <div class="status-indicator status-warning"></div>  
                <span>éœ€è¦Swap</span>  
            </div>  
            <div class="legend-item">  
                <div class="status-indicator status-error"></div>  
                <span>ææ€§ç¿»è½¬</span>  
            </div>  
        </div>  
    </div>  

    <script>  
        const NUM_LANES = 8;  
        let currentMapping = [];  
        let currentPolarity = [];  
        let currentScenario = 'normal';  

        // åœºæ™¯å®šä¹‰  
        const scenarios = {  
            normal: {  
                mapping: [0, 1, 2, 3, 4, 5, 6, 7],  
                polarity: [false, false, false, false, false, false, false, false],  
                name: 'æ­£å¸¸è¿æ¥'  
            },  
            simple_swap: {  
                mapping: [1, 0, 3, 2, 5, 4, 7, 6],  
                polarity: [false, false, false, false, false, false, false, false],  
                name: 'ç›¸é‚»Laneäº¤æ¢'  
            },  
            complex_swap: {  
                mapping: [7, 6, 5, 4, 3, 2, 1, 0],  
                polarity: [false, false, false, false, false, false, false, false],  
                name: 'å®Œå…¨åè½¬'  
            },  
            with_polarity: {  
                mapping: [2, 0, 3, 1, 6, 4, 7, 5],  
                polarity: [true, false, true, false, false, true, false, true],  
                name: 'å«ææ€§ç¿»è½¬'  
            },  
            random: {  
                mapping: [],  
                polarity: [],  
                name: 'éšæœºåœºæ™¯'  
            }  
        };  

        // åˆå§‹åŒ–  
        function init() {  
            renderLanePorts();  
            loadScenario('normal');  
        }  

        // æ¸²æŸ“Laneç«¯å£  
        function renderLanePorts() {  
            const txContainer = document.getElementById('tx-lanes');  
            const rxContainer = document.getElementById('rx-lanes');  
            
            txContainer.innerHTML = '';  
            rxContainer.innerHTML = '';  

            for (let i = 0; i < NUM_LANES; i++) {  
                // TXç«¯  
                const txPort = document.createElement('div');  
                txPort.className = 'lane-port';  
                txPort.innerHTML = `  
                    <div class="lane-label">Lane ${i}</div>  
                    <div class="connector-dot" id="tx-dot-${i}"></div>  
                `;  
                txContainer.appendChild(txPort);  

                // RXç«¯  
                const rxPort = document.createElement('div');  
                rxPort.className = 'lane-port';  
                rxPort.innerHTML = `  
                    <div class="connector-dot" id="rx-dot-${i}"></div>  
                    <div class="lane-label" id="rx-label-${i}">Lane ${i}</div>
                `;
                rxContainer.appendChild(rxPort);
            }
        }

        // åŠ è½½åœºæ™¯
        function loadScenario(scenarioName) {
            currentScenario = scenarioName;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (scenarioName === 'random') {
                // ç”Ÿæˆéšæœºæ˜ å°„
                currentMapping = generateRandomMapping();
                currentPolarity = Array(NUM_LANES).fill(0).map(() => Math.random() > 0.7);
            } else {
                currentMapping = [...scenarios[scenarioName].mapping];
                currentPolarity = [...scenarios[scenarioName].polarity];
            }

            console.log('åŠ è½½åœºæ™¯:', scenarios[scenarioName]?.name || 'éšæœºåœºæ™¯');
            console.log('æ˜ å°„:', currentMapping);
            console.log('ææ€§:', currentPolarity);

            clearConnections();
            document.getElementById('config-panel').style.display = 'none';
        }

        // ç”Ÿæˆéšæœºæ˜ å°„
        function generateRandomMapping() {
            let arr = Array.from({length: NUM_LANES}, (_, i) => i);
            // Fisher-Yatesæ´—ç‰Œç®—æ³•
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // æ˜¾ç¤ºç‰©ç†è¿æ¥
        function showPhysicalConnection() {
            clearConnections();
            
            const connectionArea = document.getElementById('connection-area');
            const areaRect = connectionArea.getBoundingClientRect();
            
            for (let txLane = 0; txLane < NUM_LANES; txLane++) {
                const rxLane = currentMapping[txLane];
                const inverted = currentPolarity[txLane];
                
                // è·å–èµ·ç‚¹å’Œç»ˆç‚¹ä½ç½®
                const txDot = document.getElementById(`tx-dot-${txLane}`);
                const rxDot = document.getElementById(`rx-dot-${rxLane}`);
                
                const txRect = txDot.getBoundingClientRect();
                const rxRect = rxDot.getBoundingClientRect();
                
                // è®¡ç®—ç›¸å¯¹äºè¿æ¥åŒºåŸŸçš„ä½ç½®
                const startX = txRect.right - areaRect.left;
                const startY = txRect.top - areaRect.top + txRect.height / 2;
                const endX = rxRect.left - areaRect.left;
                const endY = rxRect.top - areaRect.top + rxRect.height / 2;
                
                // è®¡ç®—é•¿åº¦å’Œè§’åº¦
                const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                
                // åˆ›å»ºè¿æ¥çº¿
                const line = document.createElement('div');
                line.className = 'connection-line';
                if (txLane !== rxLane || inverted) {
                    line.classList.add('crossed');
                }
                line.style.left = startX + 'px';
                line.style.top = startY + 'px';
                line.style.width = length + 'px';
                line.style.transform = `rotate(${angle}deg)`;
                line.style.color = inverted ? '#e74c3c' : '#3498db';
                
                connectionArea.appendChild(line);
                
                // æ·»åŠ äº¤æ¢æŒ‡ç¤ºå™¨
                if (txLane !== rxLane || inverted) {
                    const indicator = document.createElement('div');
                    indicator.className = 'swap-indicator';
                    indicator.style.left = (startX + endX) / 2 - 30 + 'px';
                    indicator.style.top = (startY + endY) / 2 - 15 + 'px';
                    
                    let text = `${txLane}â†’${rxLane}`;
                    if (inverted) {
                        text += ' âš¡';
                    }
                    indicator.textContent = text;
                    
                    connectionArea.appendChild(indicator);
                }
                
                // å»¶è¿ŸåŠ¨ç”»
                setTimeout(() => {
                    line.style.opacity = '1';
                }, txLane * 100);
            }

            // æ›´æ–°RXç«¯Laneæ ‡ç­¾æ˜¾ç¤ºç‰©ç†æ¥æ”¶çš„æƒ…å†µ
            for (let rxPhyLane = 0; rxPhyLane < NUM_LANES; rxPhyLane++) {
                // æ‰¾åˆ°å“ªä¸ªTX Laneè¿æ¥åˆ°è¿™ä¸ªRXç‰©ç†Lane
                const txLane = currentMapping.indexOf(rxPhyLane);
                const label = document.getElementById(`rx-label-${rxPhyLane}`);
                const inverted = currentPolarity[txLane];
                
                label.textContent = `RX${rxPhyLane} â† TX${txLane}`;
                if (inverted) {
                    label.classList.add('inverted');
                    label.textContent += ' âš¡';
                } else {
                    label.classList.remove('inverted');
                }
            }
        }

        // æ£€æµ‹Laneæ˜ å°„
        function detectLaneMapping() {
            console.log('å¼€å§‹è‡ªåŠ¨æ£€æµ‹Laneæ˜ å°„...');
            
            // æ¨¡æ‹ŸAMæ£€æµ‹è¿‡ç¨‹
            const detectedMap = [];
            const detectedPolarity = [];
            
            for (let rxPhyLane = 0; rxPhyLane < NUM_LANES; rxPhyLane++) {
                // æ‰¾åˆ°è¿æ¥åˆ°æ­¤RXç‰©ç†Laneçš„TX Lane
                const txLane = currentMapping.indexOf(rxPhyLane);
                const inverted = currentPolarity[txLane];
                
                // æ¨¡æ‹Ÿä»AMè¯»å–Lane ID
                setTimeout(() => {
                    console.log(`RXç‰©ç†Lane ${rxPhyLane}: æ£€æµ‹åˆ°æ¥è‡ªTX Lane ${txLane}` + 
                               (inverted ? ' (ææ€§ç¿»è½¬)' : ''));
                    
                    detectedMap.push({
                        physical_lane: rxPhyLane,
                        logical_lane: txLane,
                        polarity_invert: inverted
                    });
                    
                    if (detectedMap.length === NUM_LANES) {
                        displayConfiguration(detectedMap);
                    }
                }, rxPhyLane * 200);
            }
        }

        // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
        function displayConfiguration(mapping) {
            const configPanel = document.getElementById('config-panel');
            const configGrid = document.getElementById('config-grid');
            
            configPanel.style.display = 'block';
            configGrid.innerHTML = '';
            
            mapping.forEach(item => {
                const configItem = document.createElement('div');
                configItem.className = 'config-item';
                
                let statusClass = 'status-ok';
                let statusText = 'æ­£å¸¸';
                
                if (item.physical_lane !== item.logical_lane && item.polarity_invert) {
                    statusClass = 'status-error';
                    statusText = 'Swap + ææ€§ç¿»è½¬';
                } else if (item.physical_lane !== item.logical_lane) {
                    statusClass = 'status-warning';
                    statusText = 'éœ€è¦Swap';
                } else if (item.polarity_invert) {
                    statusClass = 'status-error';
                    statusText = 'ææ€§ç¿»è½¬';
                }
                
                configItem.innerHTML = `
                    <div class="config-item-header">
                        <span class="status-indicator ${statusClass}"></span>
                        RXç‰©ç†Lane ${item.physical_lane}
                    </div>
                    <div class="config-item-value">
                        æ¥æº: TX Lane ${item.logical_lane}<br>
                        çŠ¶æ€: ${statusText}<br>
                        é…ç½®: PHY${item.physical_lane} â†’ LOG${item.logical_lane}<br>
                        ææ€§: ${item.polarity_invert ? 'INVERTED' : 'NORMAL'}
                    </div>
                `;
                
                configGrid.appendChild(configItem);
            });

            // æ˜¾ç¤ºå¯„å­˜å™¨é…ç½®
            console.log('\n=== ç¡¬ä»¶å¯„å­˜å™¨é…ç½® ===');
            console.log('Lane Swap Register:');
            mapping.forEach(item => {
                console.log(`  REG[${item.physical_lane}] = 0x${item.logical_lane.toString(16)} (PHY${item.physical_lane} â†’ LOG${item.logical_lane})`);
            });
            
            let polarityReg = 0;
            mapping.forEach(item => {
                if (item.polarity_invert) {
                    polarityReg |= (1 << item.physical_lane);
                }
            });
            console.log(`Polarity Register: 0x${polarityReg.toString(16).padStart(2, '0')} (bit set = inverted)`);
        }

        // åº”ç”¨Lane Swap
        function applyLaneSwap() {
            console.log('åº”ç”¨Lane Swapé…ç½®...');
            
            // åŠ¨ç”»æ•ˆæœ: é‡æ–°æ’åˆ—è¿æ¥çº¿
            clearConnections();
            
            setTimeout(() => {
                // æ˜¾ç¤ºä¿®æ­£åçš„è¿æ¥
                const connectionArea = document.getElementById('connection-area');
                const areaRect = connectionArea.getBoundingClientRect();
                
                for (let logicLane = 0; logicLane < NUM_LANES; logicLane++) {
                    // åº”ç”¨Swapåï¼Œé€»è¾‘Laneé¡ºåºæ­£ç¡®
                    const txDot = document.getElementById(`tx-dot-${logicLane}`);
                    const rxDot = document.getElementById(`rx-dot-${logicLane}`);
                    
                    const txRect = txDot.getBoundingClientRect();
                    const rxRect = rxDot.getBoundingClientRect();
                    
                    const startX = txRect.right - areaRect.left;
                    const startY = txRect.top - areaRect.top + txRect.height / 2;
                    const endX = rxRect.left - areaRect.left;
                    const endY = rxRect.top - areaRect.top + rxRect.height / 2;
                    
                    const length = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                    const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                    
                    const line = document.createElement('div');
                    line.className = 'connection-line';
                    line.style.left = startX + 'px';
                    line.style.top = startY + 'px';
                    line.style.width = length + 'px';
                    line.style.transform = `rotate(${angle}deg)`;
                    line.style.background = 'linear-gradient(90deg, #27ae60, #2ecc71)';
                    line.style.color = '#27ae60';
                    
                    connectionArea.appendChild(line);
                    
                    setTimeout(() => {
                        line.style.opacity = '1';
                    }, logicLane * 100);
                }
                
                // æ›´æ–°RXç«¯æ ‡ç­¾æ˜¾ç¤ºé€»è¾‘Lane
                for (let i = 0; i < NUM_LANES; i++) {
                    const label = document.getElementById(`rx-label-${i}`);
                    label.textContent = `Lane ${i}`;
                    label.classList.remove('inverted');
                    label.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
                }
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                setTimeout(() => {
                    showSuccessMessage();
                }, 1000);
                
            }, 500);
        }

        // æ¸…é™¤è¿æ¥çº¿
        function clearConnections() {
            const connectionArea = document.getElementById('connection-area');
            const lines = connectionArea.querySelectorAll('.connection-line, .swap-indicator');
            lines.forEach(line => line.remove());
        }

        // é‡ç½®æ¼”ç¤º
        function resetDemo() {
            clearConnections();
            document.getElementById('config-panel').style.display = 'none';
            
            // é‡ç½®RXæ ‡ç­¾
            for (let i = 0; i < NUM_LANES; i++) {
                const label = document.getElementById(`rx-label-${i}`);
                label.textContent = `Lane ${i}`;
                label.classList.remove('inverted');
                label.style.background = 'linear-gradient(135deg, #27ae60, #2ecc71)';
            }
            
            console.clear();
            console.log('æ¼”ç¤ºå·²é‡ç½®');
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccessMessage() {
            const msg = document.createElement('div');
            msg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #27ae60, #2ecc71);
                color: white;
                padding: 40px 60px;
                border-radius: 20px;
                font-size: 24px;
                font-weight: bold;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: successPop 0.5s ease;
            `;
            msg.innerHTML = 'âœ“ Lane Swap é…ç½®æˆåŠŸï¼<br><span style="font-size: 16px;">æ‰€æœ‰Laneå·²æ­£ç¡®å¯¹é½</span>';
            
            document.body.appendChild(msg);
            
            setTimeout(() => {
                msg.style.transition = 'opacity 0.5s';
                msg.style.opacity = '0';
                setTimeout(() => msg.remove(), 500);
            }, 2000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            init();

            // æ·»åŠ ä½¿ç”¨æç¤º
            setTimeout(() => {
                const hint = document.createElement('div');
                hint.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(52, 152, 219, 0.95);
                    color: white;
                    padding: 25px;
                    border-radius: 12px;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    z-index: 1000;
                    max-width: 400px;
                    animation: slideIn 0.5s ease;
                `;
                hint.innerHTML = `
                    <strong style="font-size: 18px;">ğŸ’¡ ä½¿ç”¨è¯´æ˜</strong><br><br>
                    <div style="line-height: 2.2; font-size: 14px;">
                    1ï¸âƒ£ <strong>é€‰æ‹©åœºæ™¯</strong>: ç‚¹å‡»é¡¶éƒ¨æŒ‰é’®é€‰æ‹©ä¸åŒçš„Laneè¿æ¥åœºæ™¯<br>
                    2ï¸âƒ£ <strong>æ˜¾ç¤ºè¿æ¥</strong>: æŸ¥çœ‹ç‰©ç†å±‚å®é™…çš„Laneè¿æ¥æƒ…å†µ<br>
                    3ï¸âƒ£ <strong>è‡ªåŠ¨æ£€æµ‹</strong>: æ¨¡æ‹Ÿæ¥æ”¶ç«¯é€šè¿‡AMæ£€æµ‹Laneæ˜ å°„<br>
                    4ï¸âƒ£ <strong>åº”ç”¨é…ç½®</strong>: åº”ç”¨Lane Swapä¿®æ­£è¿æ¥<br><br>
                    <strong style="color: #f39c12;">è§‚å¯Ÿé‡ç‚¹:</strong><br>
                    â€¢ ğŸ”´ çº¢è‰²çº¿æ¡è¡¨ç¤ºäº¤å‰è¿æ¥<br>
                    â€¢ âš¡ é—ªç”µç¬¦å·è¡¨ç¤ºææ€§ç¿»è½¬<br>
                    â€¢ ğŸŸ¢ ç»¿è‰²è¡¨ç¤ºé…ç½®åæ­£ç¡®è¿æ¥<br><br>
                    æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼
                    </div>
                    <button onclick="this.parentElement.remove()" style="
                        margin-top: 15px;
                        padding: 10px 20px;
                        background: white;
                        color: #3498db;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: bold;
                        width: 100%;
                        font-size: 14px;
                    ">çŸ¥é“äº†</button>
                `;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(400px); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes successPop {
                        0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.1); }
                        100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(hint);

                setTimeout(() => {
                    if (document.body.contains(hint)) {
                        hint.style.transition = 'opacity 0.5s';
                        hint.style.opacity = '0';
                        setTimeout(() => hint.remove(), 500);
                    }
                }, 20000);
            }, 1000);
        });
    </script>
</body>
</html>
					