<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>FECè¯¯ç ç‡çº é”™æ¼”ç¤º</title>  
    <style>  
        * {  
            margin: 0;  
            padding: 0;  
            box-sizing: border-box;  
        }  

        body {  
            font-family: 'Microsoft YaHei', Arial, sans-serif;  
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);  
            padding: 20px;  
            min-height: 100vh;  
        }  

        .container {  
            max-width: 1400px;  
            margin: 0 auto;  
            background: white;  
            border-radius: 20px;  
            padding: 40px;  
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);  
        }  

        h1 {  
            text-align: center;  
            color: #2c3e50;  
            margin-bottom: 15px;  
            font-size: 32px;  
        }  

        .subtitle {  
            text-align: center;  
            color: #7f8c8d;  
            margin-bottom: 40px;  
            font-size: 16px;  
        }  

        .main-flow {  
            display: flex;  
            gap: 30px;  
            margin-bottom: 40px;  
            align-items: stretch;  
        }  

        .flow-block {  
            flex: 1;  
            background: #f8f9fa;  
            border-radius: 15px;  
            padding: 25px;  
            border: 3px solid #e9ecef;  
            position: relative;  
            transition: all 0.3s;  
        }  

        .flow-block:hover {  
            transform: translateY(-5px);  
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);  
        }  

        .flow-block.tx {  
            border-color: #27ae60;  
        }  

        .flow-block.channel {  
            border-color: #e74c3c;  
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);  
        }  

        .flow-block.rx {  
            border-color: #3498db;  
        }  

        .flow-title {  
            font-size: 20px;  
            font-weight: bold;  
            margin-bottom: 20px;  
            padding: 12px;  
            border-radius: 8px;  
            text-align: center;  
            color: white;  
        }  

        .flow-block.tx .flow-title {  
            background: linear-gradient(135deg, #27ae60, #2ecc71);  
        }  

        .flow-block.channel .flow-title {  
            background: linear-gradient(135deg, #e74c3c, #c0392b);  
        }  

        .flow-block.rx .flow-title {  
            background: linear-gradient(135deg, #3498db, #5dade2);  
        }  

        .data-display {  
            background: white;  
            padding: 15px;  
            border-radius: 8px;  
            margin: 15px 0;  
            font-family: 'Courier New', monospace;  
            font-size: 14px;  
            border-left: 4px solid #3498db;  
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);  
        }  

        .bit-stream {  
            display: flex;  
            flex-wrap: wrap;  
            gap: 3px;  
            justify-content: center;  
            margin: 15px 0;  
        }  

        .bit {  
            width: 32px;  
            height: 32px;  
            display: flex;  
            align-items: center;  
            justify-content: center;  
            border-radius: 6px;  
            font-weight: bold;  
            font-size: 14px;  
            transition: all 0.3s;  
            cursor: pointer;  
        }  

        .bit.correct {  
            background: #d4edda;  
            color: #155724;  
            border: 2px solid #28a745;  
        }  

        .bit.error {  
            background: #f8d7da;  
            color: #721c24;  
            border: 2px solid #dc3545;  
            animation: errorBlink 0.5s infinite;  
        }  

        .bit.corrected {  
            background: #fff3cd;  
            color: #856404;  
            border: 2px solid #ffc107;  
        }  

        @keyframes errorBlink {  
            0%, 100% { opacity: 1; }  
            50% { opacity: 0.5; }  
        }  

        .ber-meter {  
            margin: 25px 0;  
            padding: 20px;  
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);  
            border-radius: 12px;  
        }  

        .ber-label {  
            font-size: 16px;  
            font-weight: bold;  
            margin-bottom: 12px;  
            color: #2c3e50;  
            display: flex;  
            justify-content: space-between;  
            align-items: center;  
        }  

        .ber-value {  
            font-size: 24px;  
            font-family: 'Courier New', monospace;  
            padding: 10px 15px;  
            background: white;  
            border-radius: 8px;  
            display: inline-block;  
        }  

        .ber-value.good {  
            color: #27ae60;  
            border: 3px solid #27ae60;  
        }  

        .ber-value.warning {  
            color: #f39c12;  
            border: 3px solid #f39c12;  
        }  

        .ber-value.bad {  
            color: #e74c3c;  
            border: 3px solid #e74c3c;  
        }  

        .ber-bar {  
            height: 30px;  
            background: #ecf0f1;  
            border-radius: 15px;  
            overflow: hidden;  
            position: relative;  
            margin-top: 10px;  
        }  

        .ber-bar-fill {  
            height: 100%;  
            transition: width 0.5s ease, background 0.5s;  
            display: flex;  
            align-items: center;  
            justify-content: flex-end;  
            padding-right: 10px;  
            color: white;  
            font-weight: bold;  
            font-size: 12px;  
        }  

        .controls {  
            display: flex;  
            gap: 20px;  
            justify-content: center;  
            margin: 30px 0;  
            flex-wrap: wrap;  
        }  

        .control-group {  
            background: #f8f9fa;  
            padding: 20px;  
            border-radius: 12px;  
            min-width: 300px;  
        }  

        .control-label {  
            font-weight: bold;  
            margin-bottom: 10px;  
            color: #34495e;  
            font-size: 14px;  
        }  

        .slider-container {  
            display: flex;  
            align-items: center;  
            gap: 15px;  
            margin: 10px 0;  
        }  

        .slider {  
            flex: 1;  
            height: 8px;  
            border-radius: 4px;  
            outline: none;  
            -webkit-appearance: none;  
        }  

        .slider::-webkit-slider-thumb {  
            -webkit-appearance: none;  
            width: 20px;  
            height: 20px;  
            border-radius: 50%;  
            background: #3498db;  
            cursor: pointer;  
        }  

        .slider-value {  
            min-width: 80px;  
            text-align: right;  
            font-family: 'Courier New', monospace;  
            font-size: 13px;  
            font-weight: bold;  
            color: #2c3e50;  
        }  

        .btn {  
            padding: 12px 30px;  
            border: none;  
            border-radius: 8px;  
            font-size: 16px;  
            font-weight: bold;  
            cursor: pointer;  
            transition: all 0.3s;  
            color: white;  
        }  

        .btn-primary {  
            background: linear-gradient(135deg, #3498db, #2980b9);  
        }  

        .btn-primary:hover {  
            transform: translateY(-2px);  
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);  
        }  

        .btn-success {  
            background: linear-gradient(135deg, #27ae60, #229954);  
        }  

        .btn-danger {  
            background: linear-gradient(135deg, #e74c3c, #c0392b);  
        }  

        .stats-panel {  
            display: grid;  
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));  
            gap: 20px;  
            margin-top: 30px;  
        }  

        .stat-card {  
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);  
            color: white;  
            padding: 20px;  
            border-radius: 12px;  
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);  
        }  

        .stat-title {  
            font-size: 14px;  
            opacity: 0.9;  
            margin-bottom: 10px;  
        }  

        .stat-value {  
            font-size: 28px;  
            font-weight: bold;  
            font-family: 'Courier New', monospace;  
        }  

        .legend {  
            display: flex;  
            gap: 25px;  
            justify-content: center;  
            margin-top: 30px;  
            padding: 20px;  
            background: #f8f9fa;  
            border-radius: 12px;  
            flex-wrap: wrap;  
        }  

        .legend-item {  
            display: flex;  
            align-items: center;  
            gap: 10px;  
            font-size: 14px;  
        }  

        .legend-box {  
            width: 30px;  
            height: 30px;  
            border-radius: 6px;  
            border: 2px solid;  
        }  

        .info-box {  
            background: #e8f4f8;  
            border-left: 5px solid #3498db;  
            padding: 20px;  
            border-radius: 8px;  
            margin: 30px 0;  
        }  

        .info-box h3 {  
            color: #2980b9;  
            margin-bottom: 15px;  
        }  

        .info-box ul {  
            list-style: none;  
            line-height: 2;  
            color: #34495e;  
        }  

        .info-box li::before {  
            content: "âœ“ ";  
            color: #27ae60;  
            font-weight: bold;  
            margin-right: 8px;  
        }  

        .fec-process {  
            background: white;  
            padding: 20px;  
            border-radius: 12px;  
            margin: 20px 0;  
            border: 2px solid #3498db;  
        }  

        .fec-step {  
            padding: 15px;  
            margin: 10px 0;  
            background: #f8f9fa;  
            border-radius: 8px;  
            border-left: 4px solid #3498db;  
        }  

        .fec-step-title {  
            font-weight: bold;  
            color: #2c3e50;  
            margin-bottom: 8px;  
        }  

        .fec-step-desc {  
            color: #7f8c8d;  
            font-size: 13px;  
            line-height: 1.6;  
        }  

        @keyframes pulse {  
            0%, 100% { transform: scale(1); }  
            50% { transform: scale(1.05); }  
        }  

        .processing {  
            animation: pulse 1s infinite;  
        }  
    </style>  
</head>  
<body>  
    <div class="container">  
        <h1>ğŸ”¬ FECè¯¯ç ç‡çº é”™åŸç†æ¼”ç¤º</h1>  
        <p class="subtitle">Pre-FEC BER vs Post-FEC BER äº¤äº’å¼å¯è§†åŒ– | RS(544,514) çº é”™æ¼”ç¤º</p>  

        <!-- ä¸»æµç¨‹ -->  
        <div class="main-flow">  
            <!-- TXå‘é€ç«¯ -->  
            <div class="flow-block tx">  
                <div class="flow-title">ğŸ“¤ TX å‘é€ç«¯</div>  
                <div class="data-display">  
                    åŸå§‹æ•°æ®: å®Œç¾æ— é”™<br>  
                    æ•°æ®é•¿åº¦: <span id="tx-bits">5440</span> bits<br>  
                    é”™è¯¯æ•°: <span style="color: #27ae60; font-weight: bold;">0</span>  
                </div>  
                <div class="bit-stream" id="tx-stream"></div>  
            </div>  

            <!-- ä¿¡é“ -->  
            <div class="flow-block channel">  
                <div class="flow-title">âš¡ ç‰©ç†ä¿¡é“</div>  
                <div class="data-display" style="border-left-color: #e74c3c;">  
                    ä¿¡é“è´¨é‡: <span id="channel-quality">è‰¯å¥½</span><br>  
                    æ³¨å…¥é”™è¯¯: <span id="injected-errors">0</span> bits<br>  
                    ä¿¡é“ç±»å‹: å…‰çº¤ + SerDes  
                </div>  
                
                <div class="control-group" style="margin-top: 15px;">  
                    <div class="control-label">ğŸ”§ ä¿¡é“å™ªå£°æ³¨å…¥ (æ¨¡æ‹ŸPre-FEC BER)</div>  
                    <div class="slider-container">  
                        <input type="range" class="slider" id="noise-slider"   
                               min="0" max="100" value="10"   
                               oninput="updateNoise(this.value)">  
                        <span class="slider-value" id="noise-value">10 é”™è¯¯</span>  
                    </div>  
                </div>  
            </div>  

            <!-- RXæ¥æ”¶ç«¯ -->  
            <div class="flow-block rx">  
                <div class="flow-title">ğŸ“¥ RX æ¥æ”¶ç«¯</div>  
                
                <!-- Pre-FEC BER -->  
                <div class="ber-meter">  
                    <div class="ber-label">  
                        <span>âš ï¸ Pre-FEC BER (FECè¾“å…¥)</span>  
                        <span class="ber-value" id="pre-fec-display">0</span>  
                    </div>  
                    <div class="ber-bar">  
                        <div class="ber-bar-fill" id="pre-fec-bar" style="width: 0%; background: #27ae60;"></div>  
                    </div>  
                </div>  

                <!-- FECå¤„ç† -->  
                <div class="fec-process" id="fec-processor">  
                    <div style="font-weight: bold; color: #3498db; margin-bottom: 10px; text-align: center;">  
                        ğŸ”§ FEC RS(544,514) çº é”™ä¸­...  
                    </div>  
                    <div class="fec-step">  
                        <div class="fec-step-title">æ­¥éª¤1: ä¼´éšå¼è®¡ç®—</div>  
                        <div class="fec-step-desc">æ£€æµ‹é”™è¯¯ä½ç½®: <span id="error-positions">è®¡ç®—ä¸­...</span></div>  
                    </div>  
                    <div class="fec-step">  
                        <div class="fec-step-title">æ­¥éª¤2: é”™è¯¯çº æ­£</div>  
                        <div class="fec-step-desc">  
                            çº æ­£èƒ½åŠ›: 15 symbols (150 bits)<br>  
                            å½“å‰çº æ­£: <span id="corrected-count">0</span> bits<br>  
                            æœªçº æ­£ (UE): <span id="ue-count">0</span> bits  
                        </div>  
                    </div>  
                </div>  

                <!-- Post-FEC BER -->  
                <div class="ber-meter">  
                    <div class="ber-label">  
                        <span>âœ… Post-FEC BER (FECè¾“å‡º)</span>  
                        <span class="ber-value good" id="post-fec-display">0</span>  
                    </div>  
                    <div class="ber-bar">  
                        <div class="ber-bar-fill" id="post-fec-bar" style="width: 0%; background: #27ae60;"></div>  
                    </div>  
                </div>  

                <div class="bit-stream" id="rx-stream"></div>  
            </div>  
        </div>  

        <!-- æ§åˆ¶æŒ‰é’® -->  
        <div class="controls">  
            <button class="btn btn-primary" onclick="simulateTransmission()">  
                â–¶ï¸ å¼€å§‹ä¼ è¾“æ¨¡æ‹Ÿ  
            </button>  
            <button class="btn btn-success" onclick="autoTest()">  
                ğŸ”„ è‡ªåŠ¨æµ‹è¯•æ¨¡å¼  
            </button>  
            <button class="btn btn-danger" onclick="resetSimulation()">  
                ğŸ” é‡ç½®  
            </button>  
        </div>  

        <!-- ç»Ÿè®¡é¢æ¿ -->  
        <div class="stats-panel">  
            <div class="stat-card">  
                <div class="stat-title">æ€»ä¼ è¾“æ¯”ç‰¹</div>  
                <div class="stat-value" id="stat-total">0</div>  
            </div>  
            <div class="stat-card">  
                <div class="stat-title">Pre-FEC é”™è¯¯æ¯”ç‰¹</div>  
                <div class="stat-value" id="stat-pre-errors">0</div>  
            </div>  
            <div class="stat-card">  
                <div class="stat-title">FEC çº æ­£æ¯”ç‰¹</div>  
                <div class="stat-value" id="stat-corrected">0</div>  
            </div>  
            <div class="stat-card">  
                <div class="stat-title">Post-FEC æ®‹ä½™é”™è¯¯</div>  
                <div class="stat-value" id="stat-post-errors">0</div>  
            </div>  
        </div>  

        <!-- ä¿¡æ¯è¯´æ˜ -->  
        <div class="info-box">  
            <h3>ğŸ“– å·¥ä½œåŸç†è¯´æ˜</h3>  
            <ul>  
                <li><strong>Pre-FEC BER</strong>: æ•°æ®ç»è¿‡ç‰©ç†ä¿¡é“åçš„åŸå§‹è¯¯ç ç‡ï¼Œåæ˜ ä¿¡é“è´¨é‡</li>  
                <li><strong>FECçº é”™</strong>: RS(544,514)ç å¯çº æ­£æœ€å¤š15ä¸ªsymbol(150 bits)é”™è¯¯</li>  
                <li><strong>Post-FEC BER</strong>: ç»è¿‡FECçº é”™åçš„æ®‹ä½™è¯¯ç ç‡ï¼Œå†³å®šç³»ç»Ÿå¯é æ€§</li>  
                <li><strong>æ ‡å‡†è¦æ±‚</strong>: Pre-FEC â‰¤ 5Ã—10â»âµ, Post-FEC â‰¤ 10â»Â¹Â²</li>  
                <li><strong>UE (Uncorrectable Error)</strong>: è¶…è¿‡FECçº é”™èƒ½åŠ›çš„é”™è¯¯ï¼Œä¼šä¸ŠæŠ¥å‘Šè­¦</li>  
            </ul>  
        </div>  

        <!-- å›¾ä¾‹ -->  
        <div class="legend">  
            <div class="legend-item">  
                <div class="legend-box" style="background: #d4edda; border-color: #28a745;"></div>  
                <span>æ­£ç¡®æ¯”ç‰¹</span>  
            </div>  
            <div class="legend-item">  
                <div class="legend-box" style="background: #f8d7da; border-color: #dc3545;"></div>  
                <span>é”™è¯¯æ¯”ç‰¹ (Pre-FEC)</span>  
            </div>  
            <div class="legend-item">  
                <div class="legend-box" style="background: #fff3cd; border-color: #ffc107;"></div>  
                <span>å·²çº æ­£æ¯”ç‰¹</span>  
            </div>  
        </div>  
    </div>  

    <script>  
        const TOTAL_BITS = 5440; // RS(544,514) codeword bits  
        const MAX_CORRECTABLE = 150; // 15 symbols Ã— 10 bits  
        
        let totalTransmitted = 0;  
        let totalPreErrors = 0;  
        let totalCorrected = 0;  
        let totalPostErrors = 0;  
        let autoTestInterval = null;  

        // æ›´æ–°å™ªå£°  
        function updateNoise(value) {  
            document.getElementById('noise-value').textContent = value + ' é”™è¯¯';  
            const errorRate = value / TOTAL_BITS;  
            
            if (errorRate < 1e-5) {  
                document.getElementById('channel-quality').textContent = 'ä¼˜ç§€';  
                document.getElementById('channel-quality').style.color = '#27ae60';  
            } else if (errorRate < 5e-5) {  
                document.getElementById('channel-quality').textContent = 'è‰¯å¥½';  
                document.getElementById('channel-quality').style.color = '#f39c12';  
            } else {  
                document.getElementById('channel-quality').textContent = 'åŠ£åŒ–';  
                document.getElementById('channel-quality').style.color = '#e74c3c';  
            }  
        }  

        // æ¨¡æ‹Ÿä¼ è¾“  
        function simulateTransmission() {  
            const errorCount = parseInt(document.getElementById('noise-slider').value);  
            
            // ç”ŸæˆTXæ¯”ç‰¹æµ  
            const txBits = Array(64).fill(0).map(() => ({  
                value: Math.random() > 0.5 ? 1 : 0,  
                error: false  
            }));  

            // éšæœºæ³¨å…¥é”™è¯¯  
            const errorPositions = new Set();  
            while (errorPositions.size < Math.min(errorCount, 64)) {  
                errorPositions.add(Math.floor(Math.random() * 64));  
            }  

            // åº”ç”¨é”™è¯¯  
            const rxBits = txBits.map((bit, index) => ({  
                ...bit,  
                error: errorPositions.has(index)
            }));

            // æ˜¾ç¤ºTXæ¯”ç‰¹æµ
            displayBitStream('tx-stream', txBits);
            
            // å»¶è¿Ÿæ˜¾ç¤ºRXå‰æ¯”ç‰¹æµï¼ˆPre-FECï¼‰
            setTimeout(() => {
                displayBitStream('rx-stream', rxBits);
                
                // è®¡ç®—Pre-FEC BER
                const preErrors = rxBits.filter(b => b.error).length;
                const preFecBer = preErrors / 64;
                const scaledPreBer = (errorCount / TOTAL_BITS).toExponential(2);
                
                document.getElementById('pre-fec-display').textContent = scaledPreBer;
                document.getElementById('injected-errors').textContent = errorCount;
                document.getElementById('error-positions').textContent = Array.from(errorPositions).join(', ');
                
                // æ›´æ–°Pre-FEC BERæ˜¾ç¤º
                updateBerDisplay('pre-fec', preFecBer * 100, preFecBer);
                
                // æ‰§è¡ŒFECçº é”™
                setTimeout(() => {
                    performFecCorrection(rxBits, errorCount);
                }, 1000);
                
            }, 500);
        }

        // æ‰§è¡ŒFECçº é”™
        function performFecCorrection(bits, totalErrors) {
            const fecProcessor = document.getElementById('fec-processor');
            fecProcessor.classList.add('processing');
            
            // è®¡ç®—å¯çº æ­£å’Œä¸å¯çº æ­£é”™è¯¯
            const correctable = Math.min(totalErrors, MAX_CORRECTABLE);
            const uncorrectable = Math.max(0, totalErrors - MAX_CORRECTABLE);
            
            // æ˜¾ç¤ºçº é”™ç»Ÿè®¡
            document.getElementById('corrected-count').textContent = correctable;
            document.getElementById('ue-count').textContent = uncorrectable;
            
            // æ›´æ–°ç»Ÿè®¡
            totalTransmitted += TOTAL_BITS;
            totalPreErrors += totalErrors;
            totalCorrected += correctable;
            totalPostErrors += uncorrectable;
            
            // çº æ­£æ¯”ç‰¹æµ
            setTimeout(() => {
                const correctedBits = bits.map((bit, index) => {
                    if (bit.error && totalCorrected > 0) {
                        return { ...bit, error: false, corrected: true };
                    }
                    return bit;
                });
                
                displayBitStream('rx-stream', correctedBits);
                
                // è®¡ç®—Post-FEC BER
                const postErrors = correctedBits.filter(b => b.error).length;
                const postFecBer = postErrors / 64;
                const scaledPostBer = (uncorrectable / TOTAL_BITS).toExponential(2);
                
                document.getElementById('post-fec-display').textContent = scaledPostBer;
                
                // æ›´æ–°Post-FEC BERæ˜¾ç¤º
                updateBerDisplay('post-fec', postFecBer * 100, postFecBer);
                
                // æ›´æ–°ç»Ÿè®¡é¢æ¿
                updateStats();
                
                fecProcessor.classList.remove('processing');
                
            }, 1000);
        }

        // æ˜¾ç¤ºæ¯”ç‰¹æµ
        function displayBitStream(containerId, bits) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            bits.forEach((bit, index) => {
                const bitEl = document.createElement('div');
                bitEl.className = 'bit';
                bitEl.textContent = bit.value;
                
                if (bit.error) {
                    bitEl.classList.add('error');
                    bitEl.title = `ä½ç½® ${index}: é”™è¯¯`;
                } else if (bit.corrected) {
                    bitEl.classList.add('corrected');
                    bitEl.title = `ä½ç½® ${index}: å·²çº æ­£`;
                } else {
                    bitEl.classList.add('correct');
                    bitEl.title = `ä½ç½® ${index}: æ­£ç¡®`;
                }
                
                container.appendChild(bitEl);
            });
        }

        // æ›´æ–°BERæ˜¾ç¤º
        function updateBerDisplay(prefix, percentage, berValue) {
            const display = document.getElementById(`${prefix}-display`);
            const bar = document.getElementById(`${prefix}-bar`);
            
            // æ›´æ–°é¢œè‰²
            if (berValue < 1e-5) {
                display.className = 'ber-value good';
                bar.style.background = 'linear-gradient(90deg, #27ae60, #2ecc71)';
            } else if (berValue < 5e-5) {
                display.className = 'ber-value warning';
                bar.style.background = 'linear-gradient(90deg, #f39c12, #f1c40f)';
            } else {
                display.className = 'ber-value bad';
                bar.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            bar.style.width = Math.min(percentage, 100) + '%';
            bar.textContent = percentage.toFixed(2) + '%';
        }

        // æ›´æ–°ç»Ÿè®¡é¢æ¿
        function updateStats() {
            document.getElementById('stat-total').textContent = totalTransmitted.toLocaleString();
            document.getElementById('stat-pre-errors').textContent = totalPreErrors.toLocaleString();
            document.getElementById('stat-corrected').textContent = totalCorrected.toLocaleString();
            document.getElementById('stat-post-errors').textContent = totalPostErrors.toLocaleString();
            
            // è®¡ç®—å¹¶æ˜¾ç¤ºå®é™…BER
            const actualPreBer = totalTransmitted > 0 ? (totalPreErrors / totalTransmitted).toExponential(2) : '0';
            const actualPostBer = totalTransmitted > 0 ? (totalPostErrors / totalTransmitted).toExponential(2) : '0';
            
            console.log(`å®é™… Pre-FEC BER: ${actualPreBer}`);
            console.log(`å®é™… Post-FEC BER: ${actualPostBer}`);
        }

        // è‡ªåŠ¨æµ‹è¯•æ¨¡å¼
        function autoTest() {
            if (autoTestInterval) {
                clearInterval(autoTestInterval);
                autoTestInterval = null;
                event.target.textContent = 'ğŸ”„ è‡ªåŠ¨æµ‹è¯•æ¨¡å¼';
                event.target.classList.remove('btn-danger');
                event.target.classList.add('btn-success');
                return;
            }
            
            event.target.textContent = 'â¸ï¸ åœæ­¢æµ‹è¯•';
            event.target.classList.remove('btn-success');
            event.target.classList.add('btn-danger');
            
            autoTestInterval = setInterval(() => {
                // éšæœºç”Ÿæˆ0-100çš„é”™è¯¯æ•°
                const randomErrors = Math.floor(Math.random() * 100);
                document.getElementById('noise-slider').value = randomErrors;
                updateNoise(randomErrors);
                simulateTransmission();
            }, 4000);
        }

        // é‡ç½®æ¨¡æ‹Ÿ
        function resetSimulation() {
            if (autoTestInterval) {
                clearInterval(autoTestInterval);
                autoTestInterval = null;
            }
            
            totalTransmitted = 0;
            totalPreErrors = 0;
            totalCorrected = 0;
            totalPostErrors = 0;
            
            document.getElementById('noise-slider').value = 10;
            updateNoise(10);
            
            document.getElementById('tx-stream').innerHTML = '';
            document.getElementById('rx-stream').innerHTML = '';
            
            document.getElementById('pre-fec-display').textContent = '0';
            document.getElementById('post-fec-display').textContent = '0';
            
            document.getElementById('pre-fec-bar').style.width = '0%';
            document.getElementById('post-fec-bar').style.width = '0%';
            
            document.getElementById('error-positions').textContent = 'è®¡ç®—ä¸­...';
            document.getElementById('corrected-count').textContent = '0';
            document.getElementById('ue-count').textContent = '0';
            document.getElementById('injected-errors').textContent = '0';
            
            updateStats();
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateNoise(10);
            
            // æ·»åŠ å¿«æ·é”®æç¤º
            setTimeout(() => {
                const hint = document.createElement('div');
                hint.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(52, 152, 219, 0.95);
                    color: white;
                    padding: 20px;
                    border-radius: 12px;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    z-index: 1000;
                    max-width: 350px;
                    animation: slideIn 0.5s ease;
                `;
                hint.innerHTML = `
                    <strong style="font-size: 16px;">ğŸ’¡ ä½¿ç”¨è¯´æ˜</strong><br><br>
                    <div style="line-height: 2;">
                    1ï¸âƒ£ æ‹–åŠ¨æ»‘å—è°ƒæ•´ä¿¡é“å™ªå£°<br>
                    2ï¸âƒ£ ç‚¹å‡»"å¼€å§‹ä¼ è¾“"è§‚å¯Ÿçº é”™è¿‡ç¨‹<br>
                    3ï¸âƒ£ "è‡ªåŠ¨æµ‹è¯•"å¯è¿ç»­æµ‹è¯•ä¸åŒBER<br>
                    4ï¸âƒ£ è§‚å¯ŸPre/Post-FEC BERå˜åŒ–<br>
                    5ï¸âƒ£ é”™è¯¯æ•° > 150 æ—¶ä¼šå‡ºç°UE
                    </div>
                    <button onclick="this.parentElement.remove()" style="
                        margin-top: 15px;
                        padding: 8px 20px;
                        background: white;
                        color: #3498db;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: bold;
                        width: 100%;
                    ">çŸ¥é“äº†</button>
                `;
                
                document.body.appendChild(hint);
                
                setTimeout(() => {
                    hint.style.transition = 'opacity 0.5s';
                    hint.style.opacity = '0';
                    setTimeout(() => hint.remove(), 500);
                }, 20000);
            }, 1000);
        });

        // æ·»åŠ æ»‘å…¥åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>